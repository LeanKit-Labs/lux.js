/**
 * lux.js - Flux-based architecture for using ReactJS at LeanKit
 * Author: Jim Cowart
 * Version: v0.7.2
 * Url: https://github.com/LeanKit-Labs/lux.js
 * License(s): MIT Copyright (c) 2015 LeanKit
 */
var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){for(var n,r=[],o=t[Symbol.iterator]();!(n=o.next()).done&&(r.push(n.value),!e||r.length!==e););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_slice=Array.prototype.slice,_get=function t(e,n,r){var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o&&o.writable)return o.value;var a=o.get;return void 0===a?void 0:a.call(r)},_inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},_createClass=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};(function(t,e){"function"==typeof define&&define.amd?define(["postal","machina","lodash"],e):"object"==typeof module&&module.exports?module.exports=e(require("postal"),require("machina"),require("lodash")):t.lux=e(t.postal,t.machina,t._)})(this,function(t,e,n){function r(e,n){return n.context(e).constraint(function(e,n){return!n.hasOwnProperty("originId")||n.originId===t.instanceId()})}function o(t){{var e=t.__lux=t.__lux||{};e.cleanup=e.cleanup||[],e.subscriptions=e.subscriptions||{}}return e}function i(t){var e=[],n=!0,r=!1,o=void 0;try{for(var i,a=P(t)[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=_slicedToArray(i.value,2),c=s[0],u=s[1];e.push({actionType:c,waitFor:u.waitFor||[]})}}catch(l){r=!0,o=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw o}}return e}function a(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];if(!I[t])throw new Error("There is no action named '"+t+"'");I[t].apply(I,n)}function s(t){t="string"==typeof t?[t]:t,t.forEach(function(t){I[t]||(I[t]=function(){var e=Array.from(arguments);k.publish({topic:"execute."+t,data:{actionType:t,actionArgs:e}})})})}function c(t){if(R[t])return n.pick(I,R[t]);throw new Error("There is no action group named '"+t+"'")}function u(t){I=Object.assign(I,t)}function l(t,e){var r=R[t];r||(r=R[t]=[]),e="string"==typeof e?[e]:e;var o=n.difference(e,Object.keys(I));if(o.length)throw new Error("The following actions do not exist: "+o.join(", "));e.forEach(function(t){-1===r.indexOf(t)&&r.push(t)})}function h(t,e){var n={};n[t]=!0;var r=this.__lux,o=r.waitFor.indexOf(t);o>-1?(r.waitFor.splice(o,1),r.heardFrom.push(n),0===r.waitFor.length&&(r.heardFrom=[],this.stores.onChange.call(this,n))):this.stores.onChange.call(this,n)}function f(t){var e=this;this.__lux.waitFor=t.stores.filter(function(t){return e.stores.listenTo.indexOf(t)>-1})}function p(t){if("undefined"==typeof F)throw new Error("You attempted to use lux."+t+" without first calling lux.initReact( React );")}function d(t){p("controllerView");var e={mixins:[q,Y].concat(t.mixins||[])};return delete t.mixins,F.createClass(Object.assign(e,t))}function y(t){p("component");var e={mixins:[Y].concat(t.mixins||[])};return delete t.mixins,F.createClass(Object.assign(e,t))}function v(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return 0===n.length&&(n=[H,W]),n.forEach(function(e){if("function"==typeof e&&(e=e()),e.mixin&&Object.assign(t,e.mixin),"function"!=typeof e.setup)throw new Error("Lux mixins should have a setup method. Did you perhaps pass your mixins ahead of your target instance?");e.setup.call(t),e.teardown&&t.__lux.cleanup.push(e.teardown)}),t.luxCleanup=z,t}function g(t){return v(t,V)}function m(t){return v(t,W)}function b(t){return m(g(t))}function w(t,e,n){var r=t&&t.namespace||n.namespace;if(r in M)throw new Error('The store namespace "'+r+'" already exists.');if(!r)throw new Error("A lux store must have a namespace value provided");if(!e||!Object.keys(e).length)throw new Error("A lux store must have action handler methods provided")}function x(t,e,n){return{waitFor:[],handler:function(){var t=0,r=Array.from(arguments);return n[e].forEach(function(e){t+=e.apply(this,r)===!1?0:1}.bind(this)),t>0}}}function _(t,e){t.waitFor&&t.waitFor.forEach(function(t){-1===e.waitFor.indexOf(t)&&e.waitFor.push(t)})}function A(t,e,n){t[e]=t[e]||[],t[e].push(n.handler||n)}function E(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];var o={},i={},a={},s={};return e.forEach(function(t){var e;t&&(e=n.clone(t),n.merge(a,e.state),e.handlers&&Object.keys(e.handlers).forEach(function(t){var n=e.handlers[t];i[t]=i[t]||x(i,t,o),_(n,i[t]),A(o,t,n)}),delete e.handlers,delete e.state,n.merge(s,e))}),[a,i,s]}function O(t){M[t].dispose()}function C(t,e,n,r,o){var i=n,a=o||[];if(a.indexOf(t.namespace)>-1)throw new Error('Circular dependency detected for the "'+t.namespace+'" store when participating in the "'+r+'" action.');return t.waitFor&&t.waitFor.length&&t.waitFor.forEach(function(o){var s=e[o];if(s){a.push(t.namespace);var c=C(s,e,n+1,r,a);c>i&&(i=c)}else console.warn('The "'+r+'" action in the "'+t.namespace+'" store waits for "'+o+'" but a store with that namespace does not participate in this action.')}),i}function S(t,e){var n=[],r={};t.forEach(function(t){return r[t.namespace]=t}),t.forEach(function(t){return t.gen=C(t,r,0,e)});var o=!0,i=!1,a=void 0;try{for(var s,c=P(r)[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=_slicedToArray(s.value,2),l=(u[0],u[1]);n[l.gen]=n[l.gen]||[],n[l.gen].push(l)}}catch(h){i=!0,a=h}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw a}}return n}function T(t,e){var r=this;t.map(function(t){var o=Object.assign({deps:n.pick(r.stores,t.waitFor)},e);G.publish(""+t.namespace+".handle."+e.actionType,o)})}function j(t){var e=[],n=!0,r=!1,o=void 0;try{for(var i,a=P(R)[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=_slicedToArray(i.value,2),c=s[0],u=s[1];u.indexOf(t)>=0&&e.push(c)}}catch(l){r=!0,o=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw o}}return e}if(!("undefined"==typeof global?window:global)._babelPolyfill)throw new Error("You must include the babel polyfill on your page before lux is loaded. See https://babeljs.io/docs/usage/polyfill/ for more details.");var F,k=t.channel("lux.action"),L=t.channel("lux.store"),G=t.channel("lux.dispatcher"),M={},P=regeneratorRuntime.mark(function Q(t){var e,n,r,o,i,a;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:-1===["object","function"].indexOf(typeof t)&&(t={}),e=!0,n=!1,r=void 0,s.prev=4,o=Object.keys(t)[Symbol.iterator]();case 6:if(e=(i=o.next()).done){s.next=13;break}return a=i.value,s.next=10,[a,t[a]];case 10:e=!0,s.next=6;break;case 13:s.next=19;break;case 15:s.prev=15,s.t0=s["catch"](4),n=!0,r=s.t0;case 19:s.prev=19,s.prev=20,!e&&o["return"]&&o["return"]();case 22:if(s.prev=22,!n){s.next=25;break}throw r;case 25:return s.finish(22);case 26:return s.finish(19);case 27:case"end":return s.stop()}},Q,this,[[4,15,19,27],[20,,22,26]])}),D=function(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];var o,i=this,a=function(){},s=[],c=!0,u=!1,l=void 0;try{for(var h,f=e[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;s.push(n.pick(p,["handlers","state"])),delete p.handlers,delete p.state}}catch(d){u=!0,l=d}finally{try{!c&&f["return"]&&f["return"]()}finally{if(u)throw l}}var y=n.merge.apply(this,[{}].concat(e));return o=y&&y.hasOwnProperty("constructor")?y.constructor:function(){var t=Array.from(arguments);t[0]=t[0]||{},i.apply(this,o.mixins.concat(t))},o.mixins=s,n.merge(o,i),a.prototype=i.prototype,o.prototype=new a,y&&n.extend(o.prototype,y),o.prototype.constructor=o,o.__super__=i.prototype,o},I=Object.create(null),R={},H={setup:function(){var t=this,e=o(this),n=this.stores=this.stores||{};if(!n.listenTo||!n.listenTo.length)throw new Error("listenTo must contain at least one store namespace");var r="string"==typeof n.listenTo?[n.listenTo]:n.listenTo;if(!n.onChange)throw new Error("A component was told to listen to the following store(s): "+r+" but no onChange handler was implemented");e.waitFor=[],e.heardFrom=[],r.forEach(function(n){e.subscriptions[""+n+".changed"]=L.subscribe(""+n+".changed",function(){return h.call(t,n)})}),e.subscriptions.prenotify=G.subscribe("prenotify",function(e){return f.call(t,e)})},teardown:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=P(this.__lux.subscriptions)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i,a=_slicedToArray(r.value,2),s=a[0],c=a[1];("prenotify"===s||(i=s.split("."))&&"changed"===i.pop())&&c.unsubscribe()}}catch(u){e=!0,n=u}finally{try{!t&&o["return"]&&o["return"]()}finally{if(e)throw n}}},mixin:{}},q={componentWillMount:H.setup,componentWillUnmount:H.teardown},W={setup:function(){var t=this;this.getActionGroup=this.getActionGroup||[],this.getActions=this.getActions||[],"string"==typeof this.getActionGroup&&(this.getActionGroup=[this.getActionGroup]),"string"==typeof this.getActions&&(this.getActions=[this.getActions]);var e=function(e,n){t[e]||(t[e]=n)};this.getActionGroup.forEach(function(t){var n=!0,r=!1,o=void 0;try{for(var i,a=P(c(t))[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=_slicedToArray(i.value,2),u=s[0],l=s[1];e(u,l)}}catch(h){r=!0,o=h}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw o}}}),this.getActions.length&&this.getActions.forEach(function(t){e(t,function(){a.apply(void 0,[t].concat(_slice.call(arguments)))})})},mixin:{publishAction:a}},Y={componentWillMount:W.setup,publishAction:a},V=function(){var t=void 0===arguments[0]?{}:arguments[0],e=t.handlers,n=t.handlerFn,i=t.context,a=t.channel,c=t.topic;return{setup:function(){i=i||this;var t=o(i),u=t.subscriptions;if(e=e||i.handlers,a=a||k,c=c||"execute.*",n=n||function(t,n){var r;(r=e[t.actionType])&&r.apply(i,t.actionArgs)},!e||!Object.keys(e).length)throw new Error("You must have at least one action handler in the handlers property");if(!u||!u.actionListener){u.actionListener=r(i,a.subscribe(c,n));var h=Object.keys(e);s(h),i.namespace&&l(i.namespace,h)}},teardown:function(){this.__lux.subscriptions.actionListener.unsubscribe()}}},z=function(){var t=this;this.__lux.cleanup.forEach(function(e){return e.call(t)}),this.__lux.cleanup=void 0,delete this.__lux.cleanup};v.store=H,v.actionCreator=W,v.actionListener=V;var B={actionCreator:Y,store:q},U=function(){function t(){for(var e=arguments.length,n=Array(e),o=0;e>o;o++)n[o]=arguments[o];_classCallCheck(this,t);var a=E.apply(void 0,n),s=_slicedToArray(a,3),c=s[0],u=s[1],l=s[2];w(l,u,this);var h=l.namespace||this.namespace;Object.assign(this,l),M[h]=this;var f=!1;this.hasChanged=!1,this.getState=function(){return c},this.setState=function(t){if(!f)throw new Error("setState can only be called during a dispatch cycle from a store action handler.");c=Object.assign(c,t)},this.replaceState=function(t){if(!f)throw new Error("replaceState can only be called during a dispatch cycle from a store action handler.");Object.keys(c).forEach(function(t){delete c[t]}),c=Object.assign(c,t)},this.flush=function(){f=!1,this.hasChanged&&(this.hasChanged=!1,L.publish(""+this.namespace+".changed"))},v(this,V({context:this,channel:G,topic:""+h+".handle.*",handlers:u,handlerFn:function(t,e){if(u.hasOwnProperty(t.actionType)){f=!0;var n=u[t.actionType].handler.apply(this,t.actionArgs.concat(t.deps));this.hasChanged=n===!1?!1:!0,G.publish(""+this.namespace+".handled."+t.actionType,{hasChanged:this.hasChanged,namespace:this.namespace})}}.bind(this)})),this.__subscription={notify:r(this,G.subscribe("notify",this.flush)).constraint(function(){return f})},K.registerStore({namespace:h,actions:i(u)})}return _createClass(t,{dispose:{value:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=P(this.__subscription)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=_slicedToArray(r.value,2),a=(i[0],i[1]);a.unsubscribe()}}catch(s){e=!0,n=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(e)throw n}}delete M[this.namespace],K.removeStore(this.namespace),this.luxCleanup()}}}),t}();U.extend=D;var J=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,{initialState:"ready",actionMap:{},states:{ready:{_onEnter:function(){this.actionContext=void 0},"action.dispatch":"dispatching"},dispatching:{_onEnter:function(t){if(this.actionContext=t,t.generations.length){var e=!0,n=!1,r=void 0;try{for(var o,i=t.generations[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;T.call(t,a,t.action)}}catch(s){n=!0,r=s}finally{try{!e&&i["return"]&&i["return"]()}finally{if(n)throw r}}this.transition(t,"notifying")}else this.transition(t,"nothandled")},"action.handled":function(t,e){e.hasChanged&&t.updated.push(e.namespace)},_onExit:function(t){t.updated.length&&G.publish("prenotify",{stores:t.updated})}},notifying:{_onEnter:function(t){G.publish("notify",{action:t.action})}},nothandled:{}},getStoresHandling:function(t){var e=this.actionMap[t]||[];return{stores:e,generations:S(e,t)}}}),this.createSubscribers()}return _inherits(e,t),_createClass(e,{handleActionDispatch:{value:function(t){var e=Object.assign({action:t,generationIndex:0,updated:[]},this.getStoresHandling(t.actionType));this.handle(e,"action.dispatch")}},registerStore:{value:function(t){var e=!0,n=!1,r=void 0;try{for(var o,i=t.actions[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a,s=o.value,c=s.actionType,u={namespace:t.namespace,waitFor:s.waitFor};a=this.actionMap[c]=this.actionMap[c]||[],a.push(u)}}catch(l){n=!0,r=l}finally{try{!e&&i["return"]&&i["return"]()}finally{if(n)throw r}}}},removeStore:{value:function(t){var e=function(e){return e.namespace===t},n=!0,r=!1,o=void 0;try{for(var i,a=P(this.actionMap)[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=_slicedToArray(i.value,2),c=(s[0],s[1]),u=c.findIndex(e);-1!==u&&c.splice(u,1)}}catch(l){r=!0,o=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw o}}}},createSubscribers:{value:function(){var t=this;this.__subscriptions&&this.__subscriptions.length||(this.__subscriptions=[r(this,k.subscribe("execute.*",function(e,n){return t.handleActionDispatch(e)})),G.subscribe("*.handled.*",function(e){return t.handle(t.actionContext,"action.handled",e)}).constraint(function(){return!!t.actionContext})])}},dispose:{value:function(){this.__subscriptions&&(this.__subscriptions.forEach(function(t){return t.unsubscribe()}),this.__subscriptions=null)}}}),e}(e.BehavioralFsm),K=new J,N={printActions:function(){var t=Object.keys(I).map(function(t){return{"action name":t,stores:K.getStoresHandling(t).stores.map(function(t){return t.namespace}).join(","),groups:j(t).join(",")}});console&&console.table?(console.group("Currently Recognized Actions"),console.table(t),console.groupEnd()):console&&console.log&&console.log(t)},printStoreDepTree:function(t){var e=[];t="string"==typeof t?[t]:t,t||(t=Object.keys(I)),t.forEach(function(t){K.getStoresHandling(t).generations.forEach(function(n){for(;n.length;){var r=n.pop();e.push({"action type":t,"store namespace":r.namespace,"waits for":r.waitFor.join(","),generation:r.gen})}}),console&&console.table?(console.group("Store Dependency List for "+t),console.table(e),console.groupEnd()):console&&console.log&&(console.log("Store Dependency List for "+t+":"),console.log(e)),e=[]})}};return{actions:I,publishAction:a,addToActionGroup:l,component:y,controllerView:d,customActionCreator:u,dispatcher:K,getActionGroup:c,actionCreatorListener:b,actionCreator:m,actionListener:g,mixin:v,initReact:function(t){return F=t,this},reactMixin:B,removeStore:O,Store:U,stores:M,utils:N}});